"0","# Use a small budget"
"0","small_budget <- 5"
"0",""
"0","# Not robust version"
"0","p5 <- problem(sim_pu_raster, sim_features_not_robust_raster) %>%"
"0","  add_absolute_targets(target) %>%"
"0","  add_min_shortfall_objective(budget = small_budget) %>%"
"0","  add_binary_decisions() %>%"
"0","  add_default_solver(verbose = FALSE)"
"0",""
"0","s5 <- solve(p5)"
"0",""
"0","representation_summary <- eval_feature_representation_summary(p3, s3)"
"0",""
"0","expected_target <- representation_summary["
"0","  representation_summary$feature == 'feature_1',"
"0","  'absolute_held'"
"0","] %>%"
"0","  as.numeric"
"0",""
"0","p6 <- problem(sim_pu_raster, sim_features_robust_raster) %>%"
"0","  add_robust_constraints(feature_groupings = feature_groupings) %>%"
"0","  add_absolute_targets(target) %>%"
"0","  add_robust_min_shortfall_objective(budget = budget) %>%"
"0","  add_binary_decisions() %>%"
"0","  add_default_solver(verbose = FALSE)"
"0",""
"0","s6 <- solve(p6)"
"0",""
"0","representation_summary <- eval_feature_representation_summary(p4, s4)"
"0",""
"0","expected_robust_target <- representation_summary %>%"
"0","  filter(substr(feature, 0, 2) == 'f1') %>%"
"0","  summarise(absolute_held = min(absolute_held))"
"0","expected_robust_target <- as.numeric(expected_robust_target)"
"0",""
"0","feature_1_targets <- values(sim_feature_1 * s5) %>%"
"0","  apply(2, sum) %>%"
"0","  unname"
"0",""
"0","feature_1_targets_robust <- values(sim_feature_1 * s6) %>%"
"0","  apply(2, sum) %>%"
"0","  unname"
"0",""
"0","plot_df <- data.frame(`not_robust` = unname(feature_1_targets),"
"0","           `robust` = unname(feature_1_targets_robust)) %>%"
"0","  tidyr::pivot_longer(c('not_robust', 'robust'), names_to = 'name', values_to = 'values') %>%"
"0","  mutate(name = factor(name, c('not_robust', 'robust'), c('Not Robust', 'Robust'))) %>%"
"0","  mutate(violated = if_else(values < target, ""Violated"", ""Not violated"")) %>%"
"0","  mutate(violated = factor(violated, c(""Violated"", ""Not violated"")))"
"0",""
"0","plot_df %>%"
"0","  ggplot(aes(x = values, fill = violated)) +"
"0","  geom_histogram(color = 'white', bins = 30) +"
"0","  theme_bw() +"
"0","  geom_vline(xintercept = target, linetype = 2) +"
"0","  geom_vline(data = filter(plot_df, name == 'Not Robust'), aes(xintercept = expected_target), "
"0","             color = '#009e73') +"
"0","    geom_vline(data = filter(plot_df, name == 'Robust'), aes(xintercept = expected_robust_target), "
"0","               color = '#0072b2') +"
"0","  scale_fill_manual('', values = c('#d55e00', '#0072b2'), drop = FALSE) +"
"0","  facet_wrap(vars(name), ncol = 1) +"
"0","  theme(panel.grid = element_blank())"
