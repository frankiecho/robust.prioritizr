<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Example: Robust Conservation Planning in Victoria, Australia • robust.prioritizr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Example: Robust Conservation Planning in Victoria, Australia">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">robust.prioritizr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/robust.prioritizr.html">Getting started with robust systematic conservation planning</a></li>
    <li><a class="dropdown-item" href="../articles/climate-sdm.html">Example using simulated data from a species distribution model</a></li>
    <li><a class="dropdown-item" href="../articles/vic-cons-planning.html">Example: Robust Conservation Planning in Victoria, Australia</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/frankiecho/robust.prioritizr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Example: Robust Conservation Planning in Victoria, Australia</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/frankiecho/robust.prioritizr/blob/HEAD/vignettes/vic-cons-planning.Rmd" class="external-link"><code>vignettes/vic-cons-planning.Rmd</code></a></small>
      <div class="d-none name"><code>vic-cons-planning.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://prioritizr.net" class="external-link">prioritizr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/frankiecho/robust.prioritizr" class="external-link">robust.prioritizr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dieghernan.github.io/tidyterra/" class="external-link">tidyterra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span></code></pre></div>
<p>This example demonstrates how to use <code>robust.prioritizr</code>
for systematic conservation planning in Victoria, Australia. We will use
data for historic and future species occurrence projections,
conservation costs, and existing protected areas.</p>
<div class="section level2">
<h2 id="dataset">Dataset<a class="anchor" aria-label="anchor" href="#dataset"></a>
</h2>
<p>First, we load the <code>vic_cmip6</code> dataset, which is bundled
with the package. The primary data is a packed <code>terra</code>
SpatRaster object, which we will unwrap to access the individual raster
layers.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"vic_cmip6"</span><span class="op">)</span></span>
<span><span class="va">species</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_vic_species.html">get_vic_species</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">cost</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_vic_cost.html">get_vic_cost</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">pa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_vic_pa.html">get_vic_pa</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">species_details</span> <span class="op">&lt;-</span> <span class="va">vic_cmip6</span></span>
<span><span class="va">study_area</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_vic_study_area.html">get_vic_study_area</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The data package contains the following datasets:</p>
<ul>
<li><p><strong>Species occurrence (<code>species</code>):</strong>
Projections for 18 threatened species across four CMIP6 climate
scenarios (e.g., SSP1-RCP2.6, SSP5-RCP8.5) and five time periods
(1990-2090). Derived from Archibald et al. (2024).</p></li>
<li><p><strong>Species details (<code>species_details</code>):</strong>
A table linking the raster layer names to their corresponding species,
climate scenarios, and timesteps.</p></li>
<li><p><strong>Conservation cost (<code>cost</code>):</strong> A proxy
for conservation cost based on the 2013 Human Footprint Index by
Williams et al. (2020).</p></li>
<li><p><strong>Protected areas (<code>pa</code>):</strong> The location
of current protected areas.</p></li>
<li><p><strong>Study area (<code>study_area</code>):</strong> A boundary
for the state of Victoria.</p></li>
</ul>
<p>We first generate a plot of the current protected areas in the state,
which act as locked-in constraints that must be selected as part of a
planning solution.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pa_categorical</span> <span class="op">&lt;-</span> <span class="va">pa</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/factors.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">pa_categorical</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, cover <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Not PA"</span>, <span class="st">"Current PA"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pa_plt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://dieghernan.github.io/tidyterra/reference/geom_spatraster.html" class="external-link">geom_spatraster</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">pa_categorical</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">study_area</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span><span class="st">''</span>, </span>
<span>                    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#F0E442"</span>, <span class="st">"#009E73"</span><span class="op">)</span>,</span>
<span>                    na.value <span class="op">=</span> <span class="st">"transparent"</span>, na.translate <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'bottom'</span><span class="op">)</span></span>
<span><span class="va">pa_plt</span></span></code></pre></div>
<p><img src="vic-cons-planning_files/figure-html/unnamed-chunk-6-1.png" style="display: block; margin: auto;"></p>
<p>We can visualize the projected occurrence of the brush-tailed
rock-wallaby (<em>Petrogale penicillata</em>), a critically endangered
species in Victoria. The figure below shows that the wallaby’s suitable
habitat is projected to shrink considerably under a high-emissions
climate scenario.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wallaby</span> <span class="op">&lt;-</span> <span class="va">species_details</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">species</span> <span class="op">==</span> <span class="st">'Petrogale_penicillata'</span> <span class="op">&amp;</span> <span class="va">timestep</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1990</span>, <span class="fl">2030</span>, <span class="fl">2090</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">wallaby_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">wallaby</span>, <span class="va">id</span><span class="op">)</span></span>
<span><span class="va">wallaby_maps</span> <span class="op">&lt;-</span> <span class="va">species</span><span class="op">[[</span><span class="va">wallaby_ids</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">wallaby_maps</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">wallaby</span>, <span class="va">scenario</span><span class="op">)</span>, <span class="st">": "</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">wallaby</span>, <span class="va">timestep</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">wallaby_maps</span>, axes <span class="op">=</span> <span class="cn">F</span>, maxcell <span class="op">=</span> <span class="fl">1e4</span>, , fun<span class="op">=</span> \<span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">study_area</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="vic-cons-planning_files/figure-html/unnamed-chunk-7-1.png" style="display: block; margin: auto;"></p>
<p>As the figure illustrates, the projected distribution of species can
change dramatically depending on the time period and climate scenario.
<code>robust.prioritizr</code> is designed to handle this challenge by
integrating these different scenarios, ensuring the final conservation
plan meets its targets regardless of which future unfolds.</p>
</div>
<div class="section level2">
<h2 id="feature-groupings">Feature Groupings<a class="anchor" aria-label="anchor" href="#feature-groupings"></a>
</h2>
<p>A key concept in <code>robust.prioritizr</code> is the
<code>groups</code> argument. In a standard <code>prioritizr</code>
problem, each feature is a single data layer. However,
<code>robust.prioritizr</code> uses <strong>multiple</strong> layers to
represent a single feature, where each layer corresponds to a different
realization of the data (e.g., a climate projection or time-step), which
the analyst is uncertain about. For the purposes of this analysis, we
consider each climate projection-timestep pair a “realization” of the
data. These data realizations jointly determine the range of uncertainty
the analyst has over their input data.</p>
<p>The <code>groups</code> argument is a character vector that tells the
solver which layers belong to the same feature. This allows the problem
to apply a single, shared target to all scenarios for that feature. For
this example, the group for each layer is simply the species name. Each
group contains the indices of all of the data realizations of a
particular species.</p>
<p>For example, we see that each group (each species) contains 17 data
realizations, comprising of all the climate scenarios and time-steps
available for this analysis.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">groups</span> <span class="op">&lt;-</span> <span class="va">species_details</span><span class="op">$</span><span class="va">species</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">groups</span><span class="op">)</span></span>
<span><span class="co">#&gt; groups</span></span>
<span><span class="co">#&gt;       Anthochaera_phrygia           Burramys_parvus Gymnobelideus_leadbeateri </span></span>
<span><span class="co">#&gt;                        17                        17                        17 </span></span>
<span><span class="co">#&gt;    Lichenostomus_melanops         Liopholis_guthega          Litoria_spenceri </span></span>
<span><span class="co">#&gt;                        17                        17                        17 </span></span>
<span><span class="co">#&gt;  Miniopterus_schreibersii          Mixophyes_balbus     Neophema_chrysogaster </span></span>
<span><span class="co">#&gt;                        17                        17                        17 </span></span>
<span><span class="co">#&gt;      Pedionomus_torquatus     Petrogale_penicillata           Philoria_frosti </span></span>
<span><span class="co">#&gt;                        17                        17                        17 </span></span>
<span><span class="co">#&gt;          Pseudomys_fumeus   Pseudophryne_corroboree   Pseudophryne_pengilleyi </span></span>
<span><span class="co">#&gt;                        17                        17                        17 </span></span>
<span><span class="co">#&gt;      Sarcophilus_harrisii         Stipiturus_mallee    Tympanocryptis_lineata </span></span>
<span><span class="co">#&gt;                        17                        17                        17</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="setting-a-feasible-target">Setting a Feasible Target<a class="anchor" aria-label="anchor" href="#setting-a-feasible-target"></a>
</h2>
<p>When using a robust minimum set objective, it is crucial to set a
target that is achievable across all scenarios. If a target for a
species is higher than its total predicted occurrence in even one
scenario, the problem will be infeasible.</p>
<p><code>robust.prioritizr</code> enforces that features have the same
target within each group, ensuring that the same target is met across
all data realizations. This means that if targets are not consistent
within the same group, it will override targets specified by the user.
The package has the following internal behavior for absolute, relative
and manual targets:</p>
<ul>
<li><p>Absolute targets: ensures that the target in absolute terms is
met across all climates and time-steps</p></li>
<li><p>Relative targets: first, it calculates the “best-case” feature
values in each group, by finding the realization in the group that has
the highest summed feature value. Then, it calculates the relative
target in absolute terms by multiplying the user-supplied target (e.g.,
20%) in <code>add_relative_targets</code> with the “best-case” feature
value. This ensures that the feature representation of the solution
meets the relative target even in a “good” realization where the feature
is abundant in the study area</p></li>
<li><p>Manual targets: manual targets must be specified for each
realization of each feature. If different targets are specified for
features in the same group, <code>robust.prioritizr</code> will take the
maximum of the target. This means that manual targets should be
consistent within the same group, otherwise it would yield unexpected
behavior (particularly if the “sense” is altered to “&lt;=”).</p></li>
</ul>
<p>To figure out what useful relative targets to use, we can calculate
the worst-case and best-case feature representations for each species by
using the <code>global</code> function in <code>terra</code>, and then
summarizes the best and worst-case values using <code>dplyr</code>. We
can also find out what is the maximum relative target we can use in the
problem to ensure that our problem is still feasible.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">global_sum_species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/global.html" class="external-link">global</a></span><span class="op">(</span><span class="va">species</span>, fun <span class="op">=</span> <span class="st">'sum'</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames_to_column</a></span><span class="op">(</span><span class="st">"name"</span><span class="op">)</span></span>
<span><span class="va">worst_case_occurrence</span> <span class="op">&lt;-</span> <span class="va">species_details</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">any_of</a></span><span class="op">(</span><span class="st">"sum"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">global_sum_species</span>, by <span class="op">=</span> <span class="st">"name"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>worst_case <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">sum</span><span class="op">)</span>,</span>
<span>            pct_20 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">sum</span><span class="op">[</span><span class="va">sum</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">sum</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,</span>
<span>            cvar <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">sum</span><span class="op">[</span><span class="va">sum</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">sum</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,</span>
<span>            best_case <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">sum</span><span class="op">)</span>,</span>
<span>            max_relative_target <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="va">worst_case</span><span class="op">/</span> <span class="va">best_case</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>            pct20_relative_target <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="va">pct_20</span><span class="op">/</span> <span class="va">best_case</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>            worst_case_scenario <span class="op">=</span> <span class="va">proj</span><span class="op">[</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">which.min</a></span><span class="op">(</span><span class="va">sum</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">max_relative_target</span><span class="op">)</span> </span>
<span><span class="va">worst_case_occurrence</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 8</span></span></span>
<span><span class="co">#&gt;   species                 worst_case pct_20  cvar best_case max_relative_target</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Liopholis_guthega                1     33   5.5       452              0.002<span style="text-decoration: underline;">2</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Burramys_parvus                 17     89  28.5       816              0.020<span style="text-decoration: underline;">8</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Philoria_frosti                 20     75  29         759              0.026<span style="text-decoration: underline;">4</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Sarcophilus_harrisii           241    826 321        <span style="text-decoration: underline;">6</span>395              0.037<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Pseudophryne_corroboree         39     94  56.5       584              0.066<span style="text-decoration: underline;">8</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Litoria_spenceri               612   <span style="text-decoration: underline;">1</span>338 766.       <span style="text-decoration: underline;">2</span>738              0.224 </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: pct20_relative_target &lt;dbl&gt;, worst_case_scenario &lt;chr&gt;</span></span></span></code></pre></div>
<p>This shows that if we are interested in a fully robust solution, the
maximum relative target that is achievable for this problem would be
0.0022, as in the worst-case scenario, the Snowy Mountains skink
(<em>Liopholis guthega</em>) is only represented in 1 5km grid cell, out
of 452 grid cells in its best-case scenario. This means that even if all
the planning units are selected for conservation, in the worst-case
high-emissions climate scenario the Snowy Mountains skink will only be
represented in a very small area.</p>
<p>In this piece of code here we also lay the groundwork for alternative
relative targets we can use by computing the 20th percentile of maximum
species representation achievable. If we let the solution fall below the
target for up to 20% of the outcomes, the maximum relative target that
is achievable for the Snown Mountains skink would be near 0.073.</p>
<p>After solving the initial problem, we will progress to explore how to
increase the relative targets we use by relaxing the robustness of the
problem, such that the representation of other species in the data can
be increased.</p>
<p>To visualise the planning solutions, we also define a helper function
as follows.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Function to plot a planning solution</span></span>
<span><span class="va">plot_planning_soln</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">soln</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">soln</span><span class="op">[</span><span class="va">soln</span><span class="op">==</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span>  <span class="va">soln</span><span class="op">[</span><span class="va">pa</span><span class="op">==</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/factors.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">soln</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,</span>
<span>    cover <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Not Current PA"</span>, <span class="st">"Current PA"</span>, <span class="st">"New PA"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">plt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://dieghernan.github.io/tidyterra/reference/geom_spatraster.html" class="external-link">geom_spatraster</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">soln</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">study_area</span>, fill <span class="op">=</span> <span class="cn">NA</span>, show.legend <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span><span class="st">''</span>, </span>
<span>                      values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#F0E442"</span>, <span class="st">"#009E73"</span>, <span class="st">"#D55E00"</span><span class="op">)</span>,</span>
<span>                      na.value <span class="op">=</span> <span class="st">"transparent"</span>, na.translate <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                      drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'bottom'</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">plt</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="solving-the-robust-problem">Solving the Robust Problem<a class="anchor" aria-label="anchor" href="#solving-the-robust-problem"></a>
</h2>
<p>The workflow for a robust problem is similar to
<code>prioritizr</code>, but with the addition of robust-specific
functions. Here is a breakdown of the problem construction:</p>
<ul>
<li>
<code><a href="https://prioritizr.net/reference/problem.html" class="external-link">problem()</a></code>: Defines the planning units (cost) and
features (species scenarios).</li>
<li>
<code><a href="https://prioritizr.net/reference/add_absolute_targets.html" class="external-link">add_absolute_targets()</a></code>: Sets the conservation target
(at least 1 cell).</li>
<li>
<code><a href="../reference/add_constant_robust_constraints.html">add_constant_robust_constraints()</a></code>: Specifies the
<code>groups</code> that link scenarios to features.</li>
<li>
<code><a href="../reference/add_robust_min_set_objective.html">add_robust_min_set_objective()</a></code>: The robust version of
the minimum set objective.</li>
<li>
<code><a href="https://prioritizr.net/reference/add_locked_in_constraints.html" class="external-link">add_locked_in_constraints()</a></code>: Locks in existing
protected areas.</li>
<li>
<code><a href="https://prioritizr.net/reference/add_default_solver.html" class="external-link">add_default_solver()</a></code>: Selects the solver to use.</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rt</span> <span class="op">&lt;-</span> <span class="fl">0.0022</span></span>
<span><span class="va">rpv1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://prioritizr.net/reference/problem.html" class="external-link">problem</a></span><span class="op">(</span><span class="va">cost</span>, <span class="va">species</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://prioritizr.net/reference/add_relative_targets.html" class="external-link">add_relative_targets</a></span><span class="op">(</span><span class="va">rt</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_constant_robust_constraints.html">add_constant_robust_constraints</a></span><span class="op">(</span>groups <span class="op">=</span> <span class="va">groups</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_robust_min_set_objective.html">add_robust_min_set_objective</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://prioritizr.net/reference/add_locked_in_constraints.html" class="external-link">add_locked_in_constraints</a></span><span class="op">(</span><span class="va">pa</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://prioritizr.net/reference/add_default_solver.html" class="external-link">add_default_solver</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rsv1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">rpv1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">plot_planning_soln</span><span class="op">(</span><span class="va">rsv1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Robust Solution (Target = 1%)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="vic-cons-planning_files/figure-html/unnamed-chunk-11-1.png" style="display: block; margin: auto;"></p>
<p>The problem solves as expected.</p>
<p>We can now verify that the target was met for all species across all
scenarios and time-steps.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">feature_rep_r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/global.html" class="external-link">global</a></span><span class="op">(</span><span class="va">species</span> <span class="op">*</span> <span class="va">rsv1</span>, fun <span class="op">=</span> <span class="st">'sum'</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames_to_column</a></span><span class="op">(</span><span class="st">'name'</span><span class="op">)</span></span>
<span><span class="va">worst_case_occurrence</span><span class="op">$</span><span class="va">rt</span> <span class="op">&lt;-</span> <span class="va">rt</span><span class="op">*</span><span class="va">worst_case_occurrence</span><span class="op">$</span><span class="va">best_case</span></span>
<span><span class="va">species_details</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">any_of</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">'sum'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">scenario</span>, <span class="va">timestep</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">feature_rep_r</span>, by <span class="op">=</span> <span class="st">"name"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>species_scenario <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">scenario</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">timestep</span>, y <span class="op">=</span> <span class="va">sum</span>, color <span class="op">=</span> <span class="va">scenario</span>, group <span class="op">=</span> <span class="va">species_scenario</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">worst_case_occurrence</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">rt</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Time-step"</span>, y <span class="op">=</span> <span class="st">"Representation (number of cells)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2030</span>, <span class="fl">2090</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        legend.position <span class="op">=</span> <span class="st">'bottom'</span><span class="op">)</span></span></code></pre></div>
<p><img src="vic-cons-planning_files/figure-html/unnamed-chunk-12-1.png" style="display: block; margin: auto;"></p>
<p>The plot shows the target is met in all cases. However, since the
target was very low, there is clearly room to protect more habitat for
many species. This motivates exploring solutions with higher targets,
potentially by relaxing the robustness constraints.</p>
</div>
<div class="section level2">
<h2 id="relaxing-robustness-to-increase-the-target">Relaxing robustness to increase the target<a class="anchor" aria-label="anchor" href="#relaxing-robustness-to-increase-the-target"></a>
</h2>
<p>As the previous example shows, enforcing targets to be held robustly
across all scenarios and timesteps can be unrealistic. This limits the
maximum feasible target we can adopt for the planning solution. This
also means that there are lots of room to improve the representation of
other species. If the robustness of the target is relaxed – say instead
of having to hold across all realizations, it only needs to hold at a
certain probability – then there will be a lot more room to increase the
target.</p>
<p>Users can control the robustness of the solution through the
<code>conf_level</code> parameter in
<code>add_*_robust_constraints</code>, which specifies the proportion of
the constraints that must be met in each group for the solution to be
considered feasible. In this case, specifying 80% means that out of the
17 historic and future climate projections, the solution needs to meet
the target in at least 13 (17 ) climate projections/ time-steps. In
other words, the target can only be breached for 3 climate projections/
time-steps. By relaxing this target, we can pursue much more ambitious
relative targets (0.07 protection), while ensuring that the solution is
feasible and reasonably robust under most climate projections and
time-steps.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rt2</span> <span class="op">&lt;-</span> <span class="fl">0.07</span></span>
<span></span>
<span><span class="va">rpv2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://prioritizr.net/reference/problem.html" class="external-link">problem</a></span><span class="op">(</span><span class="va">cost</span>, <span class="va">species</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://prioritizr.net/reference/add_relative_targets.html" class="external-link">add_relative_targets</a></span><span class="op">(</span><span class="va">rt2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">robust.prioritizr</span><span class="fu">::</span><span class="fu"><a href="../reference/add_constant_robust_constraints.html">add_constant_robust_constraints</a></span><span class="op">(</span>groups <span class="op">=</span> <span class="va">groups</span>,</span>
<span>                                                     conf_level <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://prioritizr.net/reference/add_locked_in_constraints.html" class="external-link">add_locked_in_constraints</a></span><span class="op">(</span><span class="va">pa</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://prioritizr.net/reference/add_binary_decisions.html" class="external-link">add_binary_decisions</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">robust.prioritizr</span><span class="fu">::</span><span class="fu"><a href="../reference/add_robust_min_set_objective.html">add_robust_min_set_objective</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"Chance"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://prioritizr.net/reference/add_default_solver.html" class="external-link">add_default_solver</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rsv2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">rpv2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rs</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu">plot_planning_soln</span><span class="op">(</span><span class="va">rsv1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Robust (1% target)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">'none'</span>, fill <span class="op">=</span> <span class="st">'none'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">plot_planning_soln</span><span class="op">(</span><span class="va">rsv2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Partially Robust (7% target)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>guides <span class="op">=</span> <span class="st">'collect'</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'bottom'</span><span class="op">)</span></span>
<span><span class="va">rs</span></span></code></pre></div>
<p><img src="vic-cons-planning_files/figure-html/unnamed-chunk-13-1.png" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">feature_rep_r2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://prioritizr.net/reference/eval_feature_representation_summary.html" class="external-link">eval_feature_representation_summary</a></span><span class="op">(</span><span class="va">rpv2</span>, <span class="va">rsv2</span><span class="op">)</span></span>
<span><span class="va">worst_case_occurrence</span><span class="op">$</span><span class="va">rt2</span> <span class="op">&lt;-</span> <span class="va">rt2</span><span class="op">*</span><span class="va">worst_case_occurrence</span><span class="op">$</span><span class="va">best_case</span></span>
<span><span class="va">rsv2_representation</span> <span class="op">&lt;-</span> <span class="va">species_details</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>feature <span class="op">=</span> <span class="va">name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">scenario</span>, <span class="va">timestep</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">feature_rep_r2</span>, by <span class="op">=</span> <span class="st">"feature"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>species_scenario <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">scenario</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">rsv2_representation</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">timestep</span>, y <span class="op">=</span> <span class="va">absolute_held</span>, color <span class="op">=</span> <span class="va">scenario</span>, group <span class="op">=</span> <span class="va">species_scenario</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">worst_case_occurrence</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">rt2</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Time-step"</span>, y <span class="op">=</span> <span class="st">"Representation (number of cells)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2030</span>, <span class="fl">2090</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        legend.position <span class="op">=</span> <span class="st">'bottom'</span><span class="op">)</span></span></code></pre></div>
<p><img src="vic-cons-planning_files/figure-html/unnamed-chunk-14-1.png" style="display: block; margin: auto;"></p>
<p>We can also verify that indeed the relative targets are not breached
for more than 20% of the climate projections/ time-steps. The planning
solution limits the proportion where the target is breached to up to
18%, for even the most challenging species to conserve, such as the
Snowy Mountains skink (<em>Liopholis guthega</em>).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rsv2_representation</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">worst_case_occurrence</span>, by <span class="op">=</span> <span class="st">'species'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    violation_pct <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">absolute_held</span> <span class="op">&lt;</span> <span class="va">rt2</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">violation_pct</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 2</span></span></span>
<span><span class="co">#&gt;   species                 violation_pct</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Burramys_parvus                 0.176</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Liopholis_guthega               0.176</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Neophema_chrysogaster           0.176</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Philoria_frosti                 0.176</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Sarcophilus_harrisii            0.118</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Pseudophryne_corroboree         0.059</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="varying-the-confidence-level">Varying the confidence level<a class="anchor" aria-label="anchor" href="#varying-the-confidence-level"></a>
</h2>
<p>As we lower the confidence level for all species to aid the
feasibility of the problem, the optimization problem also takes
advantage of the lowered confidence level to help further reduce the
costs. This may not be desirable for some species with broader ranges
where a solution can be found even if their targets are met robustly
across all climate scenarios and time-steps. Ideally, we only want to
relax the confidence levels for species if it helps solve a problem that
would otherwise be infeasible, rather than relaxing the confidence
levels for all species.</p>
<p>In this example, we can use the
<code>add_variable_robust_constraints</code> to flexibly specify which
species we want the lowered confidence levels to apply, while ensuring
the other species meets its targets robustly across all scenarios.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">var_rob_cons</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  features <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/split.html" class="external-link">split</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span>, <span class="va">groups</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">groups</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  conf_level <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">relax_cons_species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"Liopholis_guthega"</span>,</span>
<span>  <span class="st">"Burramys_parvus"</span>,</span>
<span>  <span class="st">"Philoria_frosti"</span>,</span>
<span>  <span class="st">"Pseudophryne_corroboree"</span>,</span>
<span>  <span class="st">"Sarcophilus_harrisii"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">var_rob_cons</span><span class="op">$</span><span class="va">conf_level</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">groups</span><span class="op">)</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="va">relax_cons_species</span>, <span class="fl">0.8</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rpv3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://prioritizr.net/reference/problem.html" class="external-link">problem</a></span><span class="op">(</span><span class="va">cost</span>, <span class="va">species</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://prioritizr.net/reference/add_relative_targets.html" class="external-link">add_relative_targets</a></span><span class="op">(</span><span class="va">rt2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_variable_robust_constraints.html">add_variable_robust_constraints</a></span><span class="op">(</span><span class="va">var_rob_cons</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://prioritizr.net/reference/add_locked_in_constraints.html" class="external-link">add_locked_in_constraints</a></span><span class="op">(</span><span class="va">pa</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://prioritizr.net/reference/add_binary_decisions.html" class="external-link">add_binary_decisions</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">robust.prioritizr</span><span class="fu">::</span><span class="fu"><a href="../reference/add_robust_min_set_objective.html">add_robust_min_set_objective</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"Chance"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://prioritizr.net/reference/add_default_solver.html" class="external-link">add_default_solver</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rsv3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">rpv3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">comb_plt</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu">plot_planning_soln</span><span class="op">(</span><span class="va">rsv1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Robust (1% target)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">'none'</span>, color <span class="op">=</span> <span class="st">'none'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">plot_planning_soln</span><span class="op">(</span><span class="va">rsv2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Partially Robust (7% target)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">plot_planning_soln</span><span class="op">(</span><span class="va">rsv3</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Fully Robust* (7% target)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>guides <span class="op">=</span> <span class="st">'collect'</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'bottom'</span><span class="op">)</span></span>
<span><span class="va">comb_plt</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="st">"* Robust up to 80% probability for some species"</span><span class="op">)</span></span></code></pre></div>
<p><img src="vic-cons-planning_files/figure-html/unnamed-chunk-16-1.png" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="comparison-with-a-non-robust-solution">Comparison with a Non-Robust Solution<a class="anchor" aria-label="anchor" href="#comparison-with-a-non-robust-solution"></a>
</h2>
<p>For comparison, we solve a standard <code>prioritizr</code> problem
using only the historical baseline data and a higher target. We apply
the same 7% target to the problem, but only solve this using the
historical baseline data.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">is_historic_baseline</span> <span class="op">&lt;-</span> <span class="va">species_details</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">scenario</span> <span class="op">==</span> <span class="st">'historic_baseline'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span></span>
<span><span class="va">species_hb</span> <span class="op">&lt;-</span> <span class="va">species</span><span class="op">[[</span><span class="va">is_historic_baseline</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="va">pv1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://prioritizr.net/reference/problem.html" class="external-link">problem</a></span><span class="op">(</span><span class="va">cost</span>, <span class="va">species_hb</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://prioritizr.net/reference/add_relative_targets.html" class="external-link">add_relative_targets</a></span><span class="op">(</span><span class="fl">0.07</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://prioritizr.net/reference/add_min_set_objective.html" class="external-link">add_min_set_objective</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://prioritizr.net/reference/add_locked_in_constraints.html" class="external-link">add_locked_in_constraints</a></span><span class="op">(</span><span class="va">pa</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://prioritizr.net/reference/add_default_solver.html" class="external-link">add_default_solver</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sv1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">pv1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">comb_plt</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu">plot_planning_soln</span><span class="op">(</span><span class="va">sv1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Conventional (7% target)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">'none'</span>, color <span class="op">=</span> <span class="st">'none'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">plot_planning_soln</span><span class="op">(</span><span class="va">rsv2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Partially Robust (7% target)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>guides <span class="op">=</span> <span class="st">'collect'</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'bottom'</span><span class="op">)</span></span>
<span><span class="va">comb_plt</span></span></code></pre></div>
<p><img src="vic-cons-planning_files/figure-html/unnamed-chunk-17-1.png" style="display: block; margin: auto;"></p>
<p>While the non-robust solution may appear effective when evaluated
against the historical baseline, it may potentially miss targets under
future climate projections. We can check the representation of the
Orange-bellied parrot (<em>Neophema chrysogaster</em>) and compare it
against the partially robust solution. The partially robust solution
limits the total number of climate projections/ time-steps where the
Orange-bellied parrot representation falls below the desired target.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spotlight_species</span> <span class="op">&lt;-</span> <span class="st">'Neophema_chrysogaster'</span></span>
<span></span>
<span><span class="va">selected_species</span> <span class="op">&lt;-</span> <span class="va">species_details</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">species</span> <span class="op">==</span> <span class="va">spotlight_species</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">scenario</span>, <span class="va">timestep</span><span class="op">)</span></span>
<span><span class="va">feature_rep_nr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://prioritizr.net/reference/eval_feature_representation_summary.html" class="external-link">eval_feature_representation_summary</a></span><span class="op">(</span><span class="va">rpv2</span>, <span class="va">sv1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">feature</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="va">selected_species</span><span class="op">$</span><span class="va">name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames_to_column</a></span><span class="op">(</span><span class="st">"name"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>non_robust <span class="op">=</span> <span class="va">absolute_held</span> <span class="op">)</span></span>
<span><span class="va">feature_rep_r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://prioritizr.net/reference/eval_feature_representation_summary.html" class="external-link">eval_feature_representation_summary</a></span><span class="op">(</span><span class="va">rpv2</span>, <span class="va">rsv2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">feature</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="va">selected_species</span><span class="op">$</span><span class="va">name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames_to_column</a></span><span class="op">(</span><span class="st">"name"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>robust <span class="op">=</span> <span class="va">absolute_held</span> <span class="op">)</span></span>
<span><span class="va">feature_rep_fr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://prioritizr.net/reference/eval_feature_representation_summary.html" class="external-link">eval_feature_representation_summary</a></span><span class="op">(</span><span class="va">rpv2</span>, <span class="va">rsv3</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">feature</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="va">selected_species</span><span class="op">$</span><span class="va">name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames_to_column</a></span><span class="op">(</span><span class="st">"name"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>fully_robust <span class="op">=</span> <span class="va">absolute_held</span> <span class="op">)</span></span>
<span></span>
<span><span class="va">species_details</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>feature <span class="op">=</span> <span class="va">name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">right_join</a></span><span class="op">(</span><span class="va">feature_rep_nr</span>, by <span class="op">=</span> <span class="st">'feature'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">right_join</a></span><span class="op">(</span><span class="va">feature_rep_r</span>, by <span class="op">=</span> <span class="st">'feature'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">right_join</a></span><span class="op">(</span><span class="va">feature_rep_fr</span>, by <span class="op">=</span> <span class="st">'feature'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'non_robust'</span>, <span class="st">'robust'</span>, <span class="st">"fully_robust"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">'solution'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>solution <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">solution</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'non_robust'</span>, <span class="st">'robust'</span>, <span class="st">'fully_robust'</span><span class="op">)</span>, </span>
<span>                           <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Non-robust"</span>, <span class="st">"Partially Robust"</span>, <span class="st">"Fully Robust*"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">worst_case_occurrence</span>, by <span class="op">=</span> <span class="st">'species'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>species_scenario <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">scenario</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">timestep</span> <span class="op">&gt;</span> <span class="fl">1990</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">timestep</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">scenario</span>, group <span class="op">=</span> <span class="va">species_scenario</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">solution</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">worst_case_occurrence</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">species</span> <span class="op">==</span> <span class="va">spotlight_species</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">rt2</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Time-step"</span>, y <span class="op">=</span> <span class="st">"Representation (number of cells)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2030</span>, <span class="fl">2090</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        legend.position <span class="op">=</span> <span class="st">'bottom'</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="st">"* Robust up to 80% probability for some species"</span><span class="op">)</span></span></code></pre></div>
<p><img src="vic-cons-planning_files/figure-html/unnamed-chunk-18-1.png" style="display: block; margin: auto;"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://frankiecho.github.io/" class="external-link">Frankie Cho</a>, <a href="https://jeffrey-hanson.com" class="external-link">Jeffrey O Hanson</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
