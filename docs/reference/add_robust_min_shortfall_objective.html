<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Add robust minimum shortfall objective — add_robust_min_shortfall_objective • robust.prioritizr</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- katex math --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script><script src="../katex-auto.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Add robust minimum shortfall objective — add_robust_min_shortfall_objective"><meta name="description" content="Add an objective to a conservation planning problem that minimizes the
representation shortfalls for each feature group in a manner that is robust
to uncertainty, whilst ensuring that the total cost of the solution
does not exceed a budget."><meta property="og:description" content="Add an objective to a conservation planning problem that minimizes the
representation shortfalls for each feature group in a manner that is robust
to uncertainty, whilst ensuring that the total cost of the solution
does not exceed a budget."><meta property="og:image" content="https://frankiecho.github.io/robust.prioritizr/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">robust.prioritizr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/robust.prioritizr.html">Getting started with robust systematic conservation planning</a></li>
    <li><a class="dropdown-item" href="../articles/climate-sdm.html">Example using simulated data from a species distribution model</a></li>
    <li><a class="dropdown-item" href="../articles/vic-cons-planning.html">Example using Victoria, Australia</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/frankiecho/robust.prioritizr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Add robust minimum shortfall objective</h1>
      <small class="dont-index">Source: <a href="https://github.com/frankiecho/robust.prioritizr/blob/HEAD/R/add_robust_min_shortfall_objective.R" class="external-link"><code>R/add_robust_min_shortfall_objective.R</code></a></small>
      <div class="d-none name"><code>add_robust_min_shortfall_objective.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Add an objective to a conservation planning problem that minimizes the
representation shortfalls for each feature group in a manner that is robust
to uncertainty, whilst ensuring that the total cost of the solution
does not exceed a budget.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">add_robust_min_shortfall_objective</span><span class="op">(</span><span class="va">x</span>, <span class="va">budget</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p><code><a href="https://prioritizr.net/reference/problem.html" class="external-link">prioritizr::problem()</a></code> object.</p></dd>


<dt id="arg-budget">budget<a class="anchor" aria-label="anchor" href="#arg-budget"></a></dt>
<dd><p><code>numeric</code> value specifying the maximum expenditure of
the prioritization. For problems with multiple zones, the argument
to <code>budget</code> can be (i) a single <code>numeric</code> value to specify a single budget
for the entire solution or (ii) a <code>numeric</code> vector to specify
a separate budget for each management zone.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An updated <code><a href="https://prioritizr.net/reference/problem.html" class="external-link">prioritizr::problem()</a></code> object with the objective added
to it.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The robust minimum shortfall objective seeks to find the set of planning
units that minimizes the representation shortfall for each feature group,
subject to a budget.
In particular, a target shortfall reflects difference
between the target for a feature and the amount held by a candidate solution,
expressed as a proportion of the target.
These target shortfalls are then calculated for each of the features
associated with a feature group, and a representation shortfall is used
describe how well all the features associated with a particular feature
group are represented by a candidate solution.
Thus this objective aims to get as close as possible to
reducing the representation shortfalls shortfalls to zero,
by getting as close as possible to reaching all of the targets
for the features associated with each of the feature groups.
Since the probabilistic calculations that underpin this objective are
non-linear, the chance constraint programming method
(Charnes and Cooper 1959) is used to formulate the optimization problem as a
mixed integer linear programming problem. With this method, the
confidence level parameter (i.e.,
specified per <code>conf_level</code> with <code><a href="add_constant_robust_constraints.html">add_constant_robust_constraints()</a></code> or
<code><a href="add_variable_robust_constraints.html">add_variable_robust_constraints()</a></code>) describes the quantile
of the target shortfalls associated with the feature group
that should be minimized during optimization. For example,
if <code>conf_level = 1</code> for a feature group, then the 100th quantile is used and
this means that – after calculating the target shortfalls for each
feature associated with the feature group – the largest target
shortfall for the associated features is used to calculate the
representation shortfall for the feature group.
Additionally, if <code>conf_level = 0.5</code> for a feature group, then the
50th quantile is used and this means that the median target shortfall
for the features associated with the group is used to represent the
representation shortfall for the feature group.</p>
    </div>
    <div class="section level2">
    <h2 id="mathematical-formulation">Mathematical formulation<a class="anchor" aria-label="anchor" href="#mathematical-formulation"></a></h2>


<p>This objective can be expressed
mathematically for a set of planning units (\(I\) indexed by
\(i\)), a set of feature groups (\(J\) indexed by \(j\)), and
a set of features associated with each feature group
(\(K\) indexed by \(k\)). Let \(c_i\) denote the cost of
planning unit \(i\), \(r_{ijk}\) the amount of feature
\(k\) associated with planning unit \(i\) for feature group
\(j\), \(T_j\) the target for each feature group
\(j\), \(w_j\) the weight for each feature group
\(j\), and \(\alpha\) the confidence level for uncertainty
(specified per <code>conf_level</code> with <code><a href="add_constant_robust_constraints.html">add_constant_robust_constraints()</a></code> or
<code><a href="add_variable_robust_constraints.html">add_variable_robust_constraints()</a></code>).
Additionally, to describe the decision variables,
let \(x_i\) denote the status of the planning unit \(i\)
(e.g., specifying whether
planning unit \(i\) has been selected or not with binary values),
\(v_{jk}\) the target shortfall for each feature \(k\)
associated with each feature group \(j\),
and \(y_j\) the representation shortfall for
for each feature group \(j\).
Given this terminology, the robust minimum shortfall formulation of the
reserve selection problem is formulated as follows.</p>
<p>$$
\mathit{Minimize} \space \sum_{j = 1}^{J} w_j \times y_j \\
\mathit{subject \space to} \\
\sum_{i = 1}^{I} x_i c_i \leq B \\
\Pr_ k\{\sum_{i = 1}^{I} ( x_i \times r_{ijk} ) +
  ( T_{j} \times v_{jk} ) \geq T_j \} \geq \alpha
  \quad \forall j \in J \\
y_j \geq v_{jk} \quad \forall j \in J, k \in K \\
0 \leq y_j \leq 1 \quad \forall j \in J
$$</p>
<p>Here, the objective function (first equation) is to minimize the
weighted sum of the representation shortfalls for each feature group.
The budget constraints (second equation) ensure that the
solution does not exceed the budget.
The probabilistic constraints (third equation) specify that
only some of the target shortfall variables (i.e., \(v_{jk}\))
associated with each feature group are used to calculate the representation
shortfall for each feature group, and the subset of target shortfall
variables that are used is based on the confidence level
(i.e., \(\alpha\)).
For example, if \(\alpha=1\), then all of the target shortfall
variables associated with each feature group must be used for the
calculations.
Alternatively, if \(\alpha=0.5\), then only enough of the target
shortfall variables are required for the calculations to achieve a 50%
chance of correctly calculating the target shortfall variables for a
given feature group.
The representation shortfall constraints (fourth equation) ensure
that the representation shortfall variable for each feature group must
be greater than or equal to the target shortfall variables of the
features associated with the feature group.
In combination with the other constraints, this means that
the representation shortfall variable for a given feature group
is calculated as the largest value of a subset of the
target shortfall variables for the features associated with the feature
group, and this particular subset is based on the confidence level.
Thus if \(\alpha\) is closer to a value of 1, then the representation
shortfall variable for each feature group is calculated with
a greater degree of certainty and, in turn, the optimization process
seeks a solution that is more robust to uncertainty.
Since the probabilistic constraints are non-linear, an approximation method
is used to linearize them so that the optimization problem can be solved
with mixed integer programming exact algorithm solvers.</p>
<p>The chance constraint programming method is used to linearize the
probabilistic constraints (Charnes and Cooper 1959). To describe this
method, let \(m_{jk}\) denote a binary
auxiliary variable for each feature \(k\) associated with
feature group \(j\). Also \(K_j\) denote a
pre-computed value describing the number of
features associated with each feature group \(j\).
Given this terminology, the method involves replacing the probabilistic
constraints with the following linear constraints.</p>
<p>$$
\sum_{i = 1}^{I} x_i r_{ijk} + T_j y_j + T_j m_{jk} \geq T_{j} \quad
  \forall \space j \in J, \space k \in K \\
\sum_{k = 1}^{K_j} \frac{m_{jk}}{K_j} \leq 1 - \alpha \quad
  \forall \space j \in J\\
m_{jk} \in \{0, 1\}
$$</p>
<p>Here, the solution calculates the representation shortfall variable
for a given feature group based on a particular subset of the
target shortfalls for the associated features. Specifically, this
subset based on a particular number of the smallest target shortfall
variables based on \(\alpha\). For example, if a feature group is
associated with 30 features and \(\alpha=0.3\), then the
representation shortfall for the feature group is calculated by identifying
which 10 of these 30 features have the smallest target shortfall variables,
and then calculating the maximum value of these 10 target shortfall
variables. As such, the chance constraint programming method provides
an intuitive approximation of the probabilistic constraints.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Charnes A &amp; Cooper WW (1959) Chance-constrained programming.
<em>Management Science</em>, 6(1), 73–79.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other functions for adding robust objectives:
<code><a href="add_robust_min_set_objective.html">add_robust_min_set_objective</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Load packages</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://prioritizr.net" class="external-link">prioritizr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> terra 1.8.70</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get planning unit data</span></span></span>
<span class="r-in"><span><span class="va">pu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://prioritizr.net/reference/sim_data.html" class="external-link">get_sim_pu_raster</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get feature data</span></span></span>
<span class="r-in"><span><span class="va">features</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://prioritizr.net/reference/sim_data.html" class="external-link">get_sim_features</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the feature groups,</span></span></span>
<span class="r-in"><span><span class="co"># Here, we will assign the first 2 features to the group A, and</span></span></span>
<span class="r-in"><span><span class="co"># the remaining features to the group B</span></span></span>
<span class="r-in"><span><span class="va">groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"B"</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nlyr</a></span><span class="op">(</span><span class="va">features</span><span class="op">)</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Build problem with budget calculated as 30% total cost</span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://prioritizr.net/reference/problem.html" class="external-link">problem</a></span><span class="op">(</span><span class="va">pu</span>, <span class="va">features</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">add_robust_min_shortfall_objective</span><span class="op">(</span></span></span>
<span class="r-in"><span>    budget <span class="op">=</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/global.html" class="external-link">global</a></span><span class="op">(</span><span class="va">pu</span>, <span class="st">"sum"</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">*</span> <span class="fl">0.3</span></span></span>
<span class="r-in"><span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="add_constant_robust_constraints.html">add_constant_robust_constraints</a></span><span class="op">(</span>groups <span class="op">=</span> <span class="va">groups</span>, conf_level <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://prioritizr.net/reference/add_binary_decisions.html" class="external-link">add_binary_decisions</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://prioritizr.net/reference/add_relative_targets.html" class="external-link">add_relative_targets</a></span><span class="op">(</span><span class="fl">0.3</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://prioritizr.net/reference/add_default_solver.html" class="external-link">add_default_solver</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Solve the problem</span></span></span>
<span class="r-in"><span><span class="va">soln</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot the solution</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">soln</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="add_robust_min_shortfall_objective-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://frankiecho.github.io/" class="external-link">Frankie Cho</a>, <a href="https://jeffrey-hanson.com" class="external-link">Jeffrey O Hanson</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

