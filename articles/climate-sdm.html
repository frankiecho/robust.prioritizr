<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Example using simulated data from a species distribution model • robust.prioritizr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Example using simulated data from a species distribution model">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">robust.prioritizr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/robust.prioritizr.html">Getting started with robust systematic conservation planning</a></li>
    <li><a class="dropdown-item" href="../articles/climate-sdm.html">Example using simulated data from a species distribution model</a></li>
    <li><a class="dropdown-item" href="../articles/vic-cons-planning.html">Example: Robust Conservation Planning in Victoria, Australia</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/frankiecho/robust.prioritizr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Example using simulated data from a species distribution model</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/frankiecho/robust.prioritizr/blob/unit-tests/vignettes/climate-sdm.Rmd" class="external-link"><code>vignettes/climate-sdm.Rmd</code></a></small>
      <div class="d-none name"><code>climate-sdm.Rmd</code></div>
    </div>

    
    
<p>Systematic conservation planning problems often involve finding
least-cost solutions to ensure the representation of different species
under climate change. These involve the use of future climate projection
and the use of species distribution models that carry uncertainty from
the use of scenarios and the model fitting process. If these
uncertainties are ignored, the solution of the systematic conservation
planning problems may fail to meet its targets.</p>
<p>In this example we walk through how someone with a climate-sensitive
species distribution model can harness the flexible interface of Robust
Prioritizr to identify a conservation plan that is robust to
uncertainties emanating from both climate scenarios and the data
modelling process.</p>
<p>Robust Prioritizr is agnostic to the data generating process - users
who only wish to apply it to their own model can go directly to the
“Model Specification” section. Some familiarity with the Prioritizr
framework for solving conservation planning problems is helpful but not
necessary in understanding the vignette.</p>
<div class="section level2">
<h2 id="data-generating-process">Data generating process<a class="anchor" aria-label="anchor" href="#data-generating-process"></a>
</h2>
<p>Suppose the analyst fitted the following statistical model of the
species abundance based on data:</p>
<p>$$</p>
<p>r_{ij} (<em>{ij}) \ </em>{ij} = (_0 + _1 Temp_i + _2 Temp_i^2 + _3
Prec_i + <em>4 Prec_i^2 + </em>{ij})</p>
<p>$$</p>
<p>where the abundance
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>r</mi><annotation encoding="application/x-tex">r</annotation></semantics></math>
of species
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
in location
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
follows a Poisson distribution with the mean
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>,
which is function of the climate covariates Temperature
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mi>e</mi><mi>m</mi><mi>p</mi></mrow><annotation encoding="application/x-tex">Temp</annotation></semantics></math>
and Precipitation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>r</mi><mi>e</mi><mi>c</mi></mrow><annotation encoding="application/x-tex">Prec</annotation></semantics></math>
and a random i.i.d. error term
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ε</mi><annotation encoding="application/x-tex">\varepsilon</annotation></semantics></math>.
The relationships between the climate variables and the mean are
modelled using the regression coefficients
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>β</mi><mn>1</mn></msub><mo>,</mo><msub><mi>β</mi><mn>2</mn></msub><mo>,</mo><msub><mi>β</mi><mn>3</mn></msub><mo>,</mo><msub><mi>β</mi><mn>4</mn></msub></mrow><annotation encoding="application/x-tex">\beta_1, \beta_2, \beta_3, \beta_4</annotation></semantics></math>.
For simplicity, we assume here that its abundance only depends on these
two climatic variables.</p>
<p>We simulate the abundance data for two species as follows:</p>
<ol style="list-style-type: decimal">
<li><p>Species 1: a species with a narrow climatic niche, best adapted
to habitats with 18.5 Celsius and 1000mm of annual precipitation. Its
expected abundance drops significantly once the climate move away from
17.5C and 1000mm of annual precipitation.</p></li>
<li><p>Species 2: a species with a wider climatic niche, best adapted to
habitats with 20 Celsius and 1000mm of annual precipitation. Because it
has a wider climatic niche, its abundances are still high when
temperature and precipitation exceeds these optimal values.</p></li>
</ol>
<p>Here, we generate the temperature and precipitation values of a
simulated landscape and plot the expected abundance with respect to
temperature (holding precipitation constant). As we can see in the
figure below, Species 1 have a lower expected abundance, and its
expected abundance declines rapidly once temperature changes away from
its optimal temperature.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">19895894</span><span class="op">)</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span></span>
<span><span class="co"># Prepare baseline temperature and precipitation simulated data</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>prec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">900</span>, <span class="fl">1200</span>, length.out <span class="op">=</span> <span class="va">N</span><span class="op">)</span>,</span>
<span>                 temp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">16</span>, <span class="fl">20</span>, length.out <span class="op">=</span> <span class="va">N</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">m</span><span class="op">$</span><span class="va">temp</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">^</span><span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">0.2</span><span class="op">)</span>, <span class="va">N</span>, <span class="va">N</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">prec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">m</span><span class="op">$</span><span class="va">prec</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">^</span><span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">20</span><span class="op">)</span>, <span class="va">N</span>, <span class="va">N</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Find the coefficients of the model given the optimal temp/ prec and shape of the quadratic function</span></span>
<span><span class="va">beta_coefs</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">T_opt</span>, <span class="va">P_opt</span>, <span class="va">k_T</span>, <span class="va">k_P</span>, <span class="va">peak</span> <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">beta_0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">peak</span><span class="op">)</span> <span class="op">+</span> <span class="va">T_opt</span><span class="op">^</span><span class="fl">2</span> <span class="op">*</span> <span class="va">k_T</span><span class="op">/</span><span class="fl">2</span> <span class="op">+</span> <span class="va">P_opt</span><span class="op">^</span><span class="fl">2</span> <span class="op">*</span> <span class="va">k_P</span><span class="op">/</span><span class="fl">2</span></span>
<span>  <span class="va">beta_1</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="va">k_T</span> <span class="op">*</span> <span class="va">T_opt</span></span>
<span>  <span class="va">beta_2</span> <span class="op">&lt;-</span> <span class="va">k_T</span><span class="op">/</span><span class="fl">2</span></span>
<span>  <span class="va">beta_3</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="va">k_P</span> <span class="op">*</span> <span class="va">P_opt</span></span>
<span>  <span class="va">beta_4</span> <span class="op">&lt;-</span> <span class="va">k_P</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">beta_0</span>, <span class="va">beta_1</span>, <span class="va">beta_2</span>, <span class="va">beta_3</span>, <span class="va">beta_4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Specify climate abundance response function of the species, assume that its probability of occurrence</span></span>
<span><span class="co"># follow a multivariate Gaussian distribution of temperature and precipitation</span></span>
<span><span class="va">ab_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">temp</span>, <span class="va">prec</span>, <span class="va">betas</span>, <span class="va">sigma</span> <span class="op">=</span> <span class="fl">0</span>, <span class="va">return_vec</span> <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span></span>
<span>  <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">prec</span><span class="op">)</span></span>
<span>  <span class="va">model_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">t</span>, <span class="va">t</span><span class="op">^</span><span class="fl">2</span>, <span class="va">p</span>, <span class="va">p</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">betas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">betas</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">v</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">model_matrix</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">betas</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="va">sigma</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">return_vec</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">v</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">v</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Define function for drawing random abundance numbers based on expected abundance numbers</span></span>
<span><span class="va">rpois_matrix</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">exp_ab</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">dim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">exp_ab</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="va">dim</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">dim</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">exp_ab</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="va">dim</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, ncol <span class="op">=</span> <span class="va">dim</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Define a function that can draw abundance values based on temperature, precipitation and a matrix of beta</span></span>
<span><span class="va">ab_draw_pois</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">p</span>, <span class="va">beta</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">beta_rand</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">beta</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>,<span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">exp_ab</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">p</span>,<span class="va">...</span><span class="op">)</span> <span class="fu">ab_function</span><span class="op">(</span><span class="va">t</span>, <span class="va">p</span>, <span class="va">beta_rand</span>,<span class="va">...</span><span class="op">)</span></span>
<span>  <span class="fu">rpois_matrix</span><span class="op">(</span><span class="fu">exp_ab</span><span class="op">(</span><span class="va">temp</span>, <span class="va">prec</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="va">beta_species_1</span> <span class="op">&lt;-</span> <span class="fu">beta_coefs</span><span class="op">(</span><span class="fl">18.5</span>, <span class="fl">1000</span>, <span class="op">-</span><span class="fl">.3</span>, <span class="op">-</span><span class="fl">.005</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">beta_species_2</span> <span class="op">&lt;-</span> <span class="fu">beta_coefs</span><span class="op">(</span><span class="fl">20</span>, <span class="fl">1000</span>, <span class="op">-</span><span class="fl">.1</span>, <span class="op">-</span><span class="fl">.0001</span>, <span class="fl">8</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define functions for species 1 and 2, controlling mu for their optimal temperature and precipitation, </span></span>
<span><span class="co"># and sigma for the range it can survive in, Ntrials for scaling the absolute number of occurrences</span></span>
<span><span class="va">exp_ab_1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">p</span>,<span class="va">...</span><span class="op">)</span> <span class="fu">ab_function</span><span class="op">(</span><span class="va">t</span>, <span class="va">p</span>, <span class="va">beta_species_1</span>,<span class="va">...</span><span class="op">)</span></span>
<span><span class="va">exp_ab_2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">p</span>, <span class="va">...</span><span class="op">)</span> <span class="fu">ab_function</span><span class="op">(</span><span class="va">t</span>, <span class="va">p</span>, <span class="va">beta_species_2</span>,<span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Uncertainty in the beta parameters - suppose we estimate a model and get confidence intervals like this, use this later</span></span>
<span><span class="va">beta_species_dist_1</span> <span class="op">&lt;-</span> <span class="fu">beta_coefs</span><span class="op">(</span><span class="fl">18.5</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, <span class="fl">1000</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">*</span><span class="fl">50</span>, <span class="op">-</span><span class="fl">.5</span>, <span class="op">-</span><span class="fl">.005</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">beta_species_dist_2</span> <span class="op">&lt;-</span> <span class="fu">beta_coefs</span><span class="op">(</span><span class="fl">20</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, <span class="fl">1000</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">*</span><span class="fl">50</span>, <span class="op">-</span><span class="fl">.1</span>, <span class="op">-</span><span class="fl">.0001</span>, <span class="fl">8</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot climate response of species 1 and 2 in terms of expected abundance</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">30</span>, <span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="va">resp_1</span> <span class="op">&lt;-</span> <span class="fu">exp_ab_1</span><span class="op">(</span><span class="va">x</span>, <span class="fl">1000</span>, return_vec <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">resp_2</span> <span class="op">&lt;-</span> <span class="fu">exp_ab_2</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fl">1000</span>, return_vec <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">resp_1</span>, <span class="va">resp_2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'resp_1'</span>, <span class="st">'resp_2'</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">name</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'resp_1'</span>, <span class="st">'resp_2'</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Species 1'</span>, <span class="st">'Species 2'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>y <span class="op">=</span> <span class="st">'Expected abundance'</span>, x <span class="op">=</span> <span class="st">'Temperature'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Expected abundance of Species 1 and 2"</span><span class="op">)</span></span></code></pre></div>
<p>In this simulated landscape, we see that the range of species 1 is
much smaller compared to species 2, because it has a much narrower
climatic range.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Baseline occurrences for species 1 and 2</span></span>
<span><span class="va">baseline_ab_1</span> <span class="op">&lt;-</span> <span class="fu">rpois_matrix</span><span class="op">(</span><span class="fu">exp_ab_1</span><span class="op">(</span><span class="va">temp</span>, <span class="va">prec</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">baseline_ab_2</span> <span class="op">&lt;-</span> <span class="fu">rpois_matrix</span><span class="op">(</span><span class="fu">exp_ab_2</span><span class="op">(</span><span class="va">temp</span>, <span class="va">prec</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">baseline_rast</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">prec</span><span class="op">)</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">baseline_ab_1</span><span class="op">)</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">baseline_ab_2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">baseline_rast</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Temperature (C)"</span>, <span class="st">"Precipitation (mm)"</span>, <span class="st">"Abundance (Species 1)"</span>, <span class="st">"Abundance (Species 2)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">baseline_rast</span><span class="op">)</span></span></code></pre></div>
<p>Under future climate change, the temperature and precipitation values
are likely to change, resulting in a shift in the range of both species.
The scenario modelling community uses a set of standardized scenarios
known as the Representative Concentration Pathways (RCPs) or the Shared
Socioeconomic Pathways (SSPs) to describe future changes to climate,
economic and social variables.</p>
<p>In this simplified example, we demonstrate how Robust Prioritizr can
be used to conduct systematic conservation planning when the analyst
have predictions of future species ranges across multiple climate
scenarios. In this hypothetical example, lets assume that the
temperature and precipitation are going to change in the following
ways:</p>
<ol style="list-style-type: decimal">
<li>SSP1-RCP26: current (baseline) temperature and precipitation
values</li>
<li>SSP2-RCP45: mild climate change, temperature increase by 1 degrees
Celsius, precipitation reduces by 100mm relative to baseline</li>
<li>SSP4-RCP60: moderate climate change, temperature increase by 2
degrees Celsius, precipitation increases by 50mm on average</li>
<li>SSP5-RCP85: extreme climate change, temperature increase by 3
degrees Celsius, precipitation reduces by 150mm on average</li>
</ol>
<p>Robust Prioritizr is agnostic to the scenarios that were fed into the
model, which means that the analyst is free to specify their own
scenarios and names.</p>
<p>In the figure below, we plot the simulated abundances of species 1
and species 2 across these four RCP-SSP pairings. The climatic range of
Species 1 in particular is small and is highly sensitive to the future
climate scenario. In this case, how can an analyst design a protected
area network that accounts for these future changes in climate
niches?</p>
<p>plot(abundance_rast)</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Baseline temp and precipitation</span></span>
<span><span class="va">temp_ssp1_rcp26</span> <span class="op">&lt;-</span> <span class="va">temp</span></span>
<span><span class="va">prec_ssp1_rcp26</span> <span class="op">&lt;-</span> <span class="va">prec</span></span>
<span></span>
<span><span class="co"># SSP2-RCP45</span></span>
<span><span class="va">temp_ssp2_rcp45</span> <span class="op">&lt;-</span> <span class="va">temp</span> <span class="op">+</span> <span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">^</span><span class="fl">2</span>, sd <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span>, <span class="va">N</span>, <span class="va">N</span><span class="op">)</span></span>
<span><span class="va">prec_ssp2_rcp45</span> <span class="op">&lt;-</span> <span class="va">prec</span> <span class="op">-</span> <span class="fl">100</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">^</span><span class="fl">2</span>, sd <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>, <span class="va">N</span>, <span class="va">N</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># SSP4-RCP60</span></span>
<span><span class="va">temp_ssp4_rcp60</span> <span class="op">&lt;-</span> <span class="va">temp</span> <span class="op">+</span> <span class="fl">2</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">^</span><span class="fl">2</span>, sd <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span>, <span class="va">N</span>, <span class="va">N</span><span class="op">)</span></span>
<span><span class="va">prec_ssp4_rcp60</span> <span class="op">&lt;-</span> <span class="va">prec</span> <span class="op">+</span> <span class="fl">50</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">^</span><span class="fl">2</span>, sd <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>, <span class="va">N</span>, <span class="va">N</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># SSP5-RCP85</span></span>
<span><span class="va">temp_ssp5_rcp85</span> <span class="op">&lt;-</span> <span class="va">temp</span> <span class="op">+</span> <span class="fl">4</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">^</span><span class="fl">2</span>, sd <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span>, <span class="va">N</span>, <span class="va">N</span><span class="op">)</span></span>
<span><span class="va">prec_ssp5_rcp85</span> <span class="op">&lt;-</span> <span class="va">prec</span> <span class="op">-</span> <span class="fl">100</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">^</span><span class="fl">2</span>, sd <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>, <span class="va">N</span>, <span class="va">N</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Simulate abundance levels given future climates</span></span>
<span><span class="va">ssp1_rcp26_ab_1</span> <span class="op">&lt;-</span> <span class="fu">rpois_matrix</span><span class="op">(</span><span class="fu">exp_ab_1</span><span class="op">(</span><span class="va">temp_ssp1_rcp26</span>, <span class="va">prec_ssp1_rcp26</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ssp1_rcp26_ab_2</span> <span class="op">&lt;-</span> <span class="fu">rpois_matrix</span><span class="op">(</span><span class="fu">exp_ab_2</span><span class="op">(</span><span class="va">temp_ssp1_rcp26</span>, <span class="va">prec_ssp1_rcp26</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ssp2_rcp45_ab_1</span> <span class="op">&lt;-</span> <span class="fu">rpois_matrix</span><span class="op">(</span><span class="fu">exp_ab_1</span><span class="op">(</span><span class="va">temp_ssp2_rcp45</span>, <span class="va">prec_ssp2_rcp45</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ssp2_rcp45_ab_2</span> <span class="op">&lt;-</span> <span class="fu">rpois_matrix</span><span class="op">(</span><span class="fu">exp_ab_2</span><span class="op">(</span><span class="va">temp_ssp2_rcp45</span>, <span class="va">prec_ssp2_rcp45</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ssp4_rcp60_ab_1</span> <span class="op">&lt;-</span> <span class="fu">rpois_matrix</span><span class="op">(</span><span class="fu">exp_ab_1</span><span class="op">(</span><span class="va">temp_ssp4_rcp60</span>, <span class="va">prec_ssp4_rcp60</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ssp4_rcp60_ab_2</span> <span class="op">&lt;-</span> <span class="fu">rpois_matrix</span><span class="op">(</span><span class="fu">exp_ab_2</span><span class="op">(</span><span class="va">temp_ssp4_rcp60</span>, <span class="va">prec_ssp4_rcp60</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ssp5_rcp85_ab_1</span> <span class="op">&lt;-</span> <span class="fu">rpois_matrix</span><span class="op">(</span><span class="fu">exp_ab_1</span><span class="op">(</span><span class="va">temp_ssp5_rcp85</span>, <span class="va">prec_ssp5_rcp85</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ssp5_rcp85_ab_2</span> <span class="op">&lt;-</span> <span class="fu">rpois_matrix</span><span class="op">(</span><span class="fu">exp_ab_2</span><span class="op">(</span><span class="va">temp_ssp5_rcp85</span>, <span class="va">prec_ssp5_rcp85</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Simulate conservation costs</span></span>
<span><span class="va">costs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">^</span><span class="fl">2</span>, <span class="fl">100</span>, <span class="fl">20</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="va">N</span>, nrow <span class="op">=</span> <span class="va">N</span><span class="op">)</span></span>
<span><span class="va">costs</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">N</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,ncol <span class="op">=</span> <span class="va">N</span>, nrow <span class="op">=</span> <span class="va">N</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.05</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span> <span class="co"># Assume some locked-out constraints</span></span>
<span></span>
<span><span class="va">costs_rast</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">costs</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">costs_rast</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"Cost"</span></span>
<span></span>
<span><span class="co"># Group abundances</span></span>
<span><span class="va">abundance_rast</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">ssp1_rcp26_ab_1</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">ssp2_rcp45_ab_1</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">ssp4_rcp60_ab_1</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">ssp5_rcp85_ab_1</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">ssp1_rcp26_ab_2</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">ssp2_rcp45_ab_2</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">ssp4_rcp60_ab_2</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">ssp5_rcp85_ab_2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">abundance_rast</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'ssp1_rcp26_ab_1'</span>, </span>
<span>                       <span class="st">'ssp2_rcp45_ab_1'</span>,</span>
<span>                       <span class="st">'ssp4_rcp60_ab_1'</span>,</span>
<span>                       <span class="st">'ssp5_rcp85_ab_1'</span>,</span>
<span>                       <span class="st">'ssp1_rcp26_ab_2'</span>, </span>
<span>                       <span class="st">'ssp2_rcp45_ab_2'</span>,</span>
<span>                       <span class="st">'ssp4_rcp60_ab_2'</span>,</span>
<span>                       <span class="st">'ssp5_rcp85_ab_2'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">abundance_rast</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="model-specification">Model specification<a class="anchor" aria-label="anchor" href="#model-specification"></a>
</h2>
<p>We start with a conservation problem where an analyst is tasked with
finding the minimum-set protected area network by selecting planning
units for protecting two species and ensure that their targets are
robust under climate change.</p>
<p>There are many types of uncertainty an analyst can face. Robust
Prioritizr is agnostic to the type of uncertainty that is specified,
although it is generally useful to be clear on what types of uncertainty
exists in a typical systematic conservation planning problem:</p>
<ul>
<li><p>Scenario Uncertainty: there are many plausible future scenarios
to which features in a planning problem might be affected by</p></li>
<li><p>Model Uncertainty: there are different models of ecological
systems and conservation costs, or different approaches to modelling
ecological systems and costs</p></li>
<li><p>Parameter Uncertainty: uncertainty over the specific values of
parameters used in the model</p></li>
<li><p>Randomness and errors in the model predictions itself</p></li>
</ul>
<p>In our first example, we focus mostly on scenario uncertainty, while
we will start to build in randomness from the model in the latter parts
of the analysis.</p>
<p>Consider that the analyst has set of predictions of future species
abundances for two species under four future RCP-SSP scenarios
(SSP1-RCP2.6, SSP2-RCP4.5, SSP4-RCP6.0, and SSP5-RCP8.5), with a
specified conservation cost. In the diagram below, we plot the abundance
estimates across climate scenarios and its cost:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">abundance_rast</span>, <span class="va">costs_rast</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The solution identified must satisfy the following constraints:</p>
<ol style="list-style-type: decimal">
<li>The total summed abundance of Species 1 within the protected area
network must be more than 20 across all planning units across all
climate scenarios</li>
<li>The total summed abundance of Species 1 within the protected area
network must be more than 20 across all planning units across all
climate scenarios</li>
<li>Not select any units with locked-out constraints (Cost = NA)</li>
</ol>
<p>For simplicity, we do not specify additional constraints, such as
connectivity constraints or boundary penalties, in this planning
problem.</p>
</div>
<div class="section level2">
<h2 id="solving-with-standard-prioritizr">Solving with standard Prioritizr<a class="anchor" aria-label="anchor" href="#solving-with-standard-prioritizr"></a>
</h2>
<p>As a first pass, we can solve this problem in the traditional
Prioritizr specification, using only one of the climate scenarios
(SSP2-RCP4.5) for planning. The specification below solves the following
conservation planning problem:</p>
<p><span class="math display">$$
\min \sum_{i=1}^{I} x_i c_i \\
\text{subject to} \\
\sum_{i=1}^I x_i r_{ij} \geq T_j \quad \forall \space j \in J \\
x_i \in \{0,1\} \quad \forall \space i \in I
$$</span></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>
is the binary decision variable of whether to protect cell
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
or not,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>c</mi><annotation encoding="application/x-tex">c</annotation></semantics></math>
is the conservation cost,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>r</mi><annotation encoding="application/x-tex">r</annotation></semantics></math>
is the abundance of species
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
in cell
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
(taken as the abundance under SSP2-RCP4.5 at the moment) and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation></semantics></math>
is the representation target for species
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
(taken as 20 for all species at the moment).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">target</span> <span class="op">&lt;-</span> <span class="fl">20</span></span>
<span><span class="va">abundance_ssp2_rcp45</span> <span class="op">&lt;-</span> <span class="va">abundance_rast</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'ssp2_rcp45_ab_1'</span>,</span>
<span>                                         <span class="st">'ssp2_rcp45_ab_2'</span><span class="op">)</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://prioritizr.net/reference/problem.html" class="external-link">problem</a></span><span class="op">(</span><span class="va">costs_rast</span>, <span class="va">abundance_ssp2_rcp45</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://prioritizr.net/reference/add_min_set_objective.html" class="external-link">add_min_set_objective</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://prioritizr.net/reference/add_absolute_targets.html" class="external-link">add_absolute_targets</a></span><span class="op">(</span><span class="va">target</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://prioritizr.net/reference/add_binary_decisions.html" class="external-link">add_binary_decisions</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://prioritizr.net/reference/add_default_solver.html" class="external-link">add_default_solver</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span></span>
<span><span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">p1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">s1</span><span class="op">)</span></span></code></pre></div>
<p>The challenge with this planning approach is that it does not account
for other climates. As a result, the planning solution would fail to
reach the targets in other climate scenarios, particularly under the
extreme climate scenario SSP5-RCP8.5.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_solution_eval</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">soln</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">representation_rs1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">abundance_rast</span> <span class="op">*</span> <span class="va">soln</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="fl">2</span>, <span class="va">sum</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>value <span class="op">=</span> <span class="va">representation_rs1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">representation_rs1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">name</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">representation_rs1</span><span class="op">)</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">representation_rs1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>target_met <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">value</span> <span class="op">&gt;=</span> <span class="va">target</span>, <span class="st">'Target met'</span>, <span class="st">'Target not met'</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, y <span class="op">=</span> <span class="va">name</span>, fill <span class="op">=</span> <span class="va">target_met</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_bar</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">'identity'</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">target</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'#0072B2'</span>, <span class="st">'#D55E00'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Abundance in PA'</span>, y <span class="op">=</span> <span class="st">''</span>, fill <span class="op">=</span> <span class="st">''</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">plot_solution_eval</span><span class="op">(</span><span class="va">s1</span><span class="op">)</span></span></code></pre></div>
<p>The planning solution identified is not robust to alternative climate
scenarios, as the abundance levels within the identified protected area
network falls below the target in scenarios other than the selected
SSP2-RCP4.5. In particular, it represented almost none of Species 1
under an extreme climate scenario.</p>
</div>
<div class="section level2">
<h2 id="solving-with-robust-prioritizr">Solving with Robust Prioritizr<a class="anchor" aria-label="anchor" href="#solving-with-robust-prioritizr"></a>
</h2>
<p>Robust Prioritizr gives users a flexible interface to solve
conservation planning problems that are robust to alternative climate
scenarios and other sources of uncertainty. Using the modified minimum
set objective, users can solve the following problem:</p>
<p><span class="math display">$$
\min \sum_{i=1}^{I} x_i c_i \\ \text{subject to} \\ \Pr_k \{
\sum_{i=1}^I x_i r_{ijk} \geq T_j \} \geq \alpha \quad \forall \space j
\in J \\ x_i \in \{0,1\} \quad \forall \space i \in I
$$</span></p>
<p>where now
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>r</mi><annotation encoding="application/x-tex">r</annotation></semantics></math>
is indexed by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>,
the feature value for the specific realization (i.e., climate scenario).
The problem ensures that the targets are met not just in one specific
realization of species abundance, but across many different realizations
of scenario
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>,
such that the probability that the targets are met across the
realizations exceeds a certain confidence level
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>.
If
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\alpha=1</annotation></semantics></math>
(the default and most robust approach), then the solution must meet the
species abundance targets across all realizations
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
and all species
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>.</p>
<p>Specification of alternative predictions of abundance the same
species is achieved through the <code>groups</code> argument of the call
to Robust Prioritizr. This enables the user to pass in alternative
specifications of the species abundance values in one raster in
Prioritizr and tell the problem that these indeed represent the same
species/ features across different realizations.</p>
<p>We can extract the relevant groupings from the names of the raster
object that we have specified, depending on the specific formatting of
the names. These groupings are then supplied to
<code>add_*_robust_constraints</code> .</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Recall that the abundance raster is ordered by scenario, then by species, </span></span>
<span><span class="co"># i.e. species_1_scenario_1, species_1_scenario_2 etc.</span></span>
<span><span class="va">scenario_matrix</span> <span class="op">&lt;-</span> <span class="fu">str_split_fixed</span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">abundance_rast</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">'_'</span>, n <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"species_"</span>, <span class="va">scenario_matrix</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span><span class="op">)</span> <span class="co"># Extract the index in the fourth position</span></span>
<span><span class="va">groups</span></span></code></pre></div>
<p>Then, we can solve the problem using Robust Prioritizr, supplying the
full raster containing all the abundance predictions across all climate
scenarios and the groups argument. For now, we keep the confidence level
to 1, ensuring that the targets are met for all species across all
scenarios. We can use the robust minimum set objective by invoking
<code>add_robust_min_set_objective</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rp1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://prioritizr.net/reference/problem.html" class="external-link">problem</a></span><span class="op">(</span><span class="va">costs_rast</span>, <span class="va">abundance_rast</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_constant_robust_constraints.html">add_constant_robust_constraints</a></span><span class="op">(</span>groups <span class="op">=</span> <span class="va">groups</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://prioritizr.net/reference/add_absolute_targets.html" class="external-link">add_absolute_targets</a></span><span class="op">(</span><span class="va">target</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_robust_min_set_objective.html">add_robust_min_set_objective</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://prioritizr.net/reference/add_binary_decisions.html" class="external-link">add_binary_decisions</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://prioritizr.net/reference/add_default_solver.html" class="external-link">add_default_solver</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rs1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">rp1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">s1_combined</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">s1</span>, <span class="va">rs1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">s1_combined</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Not robust'</span>, <span class="st">'Robust'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">s1_combined</span><span class="op">)</span></span></code></pre></div>
<p>The robust solution identified a lot more planning units compared to
the non-robust solution. This is likely because a lot more planning
units are needed to ensure that the species ranges are covered across
multiple plausible climate scenarios.</p>
<p>We can examine whether the robust solution indeed meets the targets
across all of the specified climate scenarios:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot_solution_eval</span><span class="op">(</span><span class="va">rs1</span><span class="op">)</span></span></code></pre></div>
<p>The total abundance in the robust PA network now exceeds the targets
in every climate scenario.</p>
</div>
<div class="section level2">
<h2 id="why-not-just-use-the-worst-case-scenario">Why not just use the worst-case scenario?<a class="anchor" aria-label="anchor" href="#why-not-just-use-the-worst-case-scenario"></a>
</h2>
<p>The reader is justified in questioning why Robust Prioritizr exists
when there could be alternative simple data transformations that the
analyst can use to alter the problem to make it appear more
conservative. Here we consider three possible approaches and see why
these generate a different and inferior solution compared to Robust
Prioritizr:</p>
<ol style="list-style-type: decimal">
<li>Taking the most extreme climate scenario: the intuition being that
if a protected area network meets its target under the most extreme
climate scenario, it would be conservative enough to meet the targets in
other climate scenarios</li>
<li>Adding a buffer to the target</li>
<li>Taking the minimum values in each planning unit for each
species</li>
</ol>
<div class="section level3">
<h3 id="taking-the-most-extreme-climate-scenario">Taking the most extreme climate scenario<a class="anchor" aria-label="anchor" href="#taking-the-most-extreme-climate-scenario"></a>
</h3>
<p>Given in particular the narrow ranges of Species 1, we can see that a
protected area network that specifically focuses on protecting its
climatic niches under the extreme climate scenario (SSP5-RCP8.5) would
still fail to meet its targets under a milder climate scenario.
Protecting species with narrow climate niches like Species 1 requires a
planning solution that jointly considers all, not just one, climate
scenario.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">abundance_ssp5_rcp85</span> <span class="op">&lt;-</span> <span class="va">abundance_rast</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'ssp5_rcp85_ab_1'</span>,</span>
<span>                                         <span class="st">'ssp5_rcp85_ab_2'</span><span class="op">)</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">p2a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://prioritizr.net/reference/problem.html" class="external-link">problem</a></span><span class="op">(</span><span class="va">costs_rast</span>, <span class="va">abundance_ssp5_rcp85</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://prioritizr.net/reference/add_min_set_objective.html" class="external-link">add_min_set_objective</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://prioritizr.net/reference/add_absolute_targets.html" class="external-link">add_absolute_targets</a></span><span class="op">(</span><span class="va">target</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://prioritizr.net/reference/add_binary_decisions.html" class="external-link">add_binary_decisions</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://prioritizr.net/reference/add_default_solver.html" class="external-link">add_default_solver</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span></span>
<span><span class="va">s2a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">p2a</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">plot_solution_eval</span><span class="op">(</span><span class="va">s2a</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="adding-a-buffer-to-the-target">Adding a buffer to the target<a class="anchor" aria-label="anchor" href="#adding-a-buffer-to-the-target"></a>
</h3>
<p>Increasing targets might appear to be an easy fix, but it does not
account for the reality that the area with abundant species under one
climate scenario is not the same as the area with abundant species under
a different climate scenario. Thus, increasing the target is only going
to select more planning units in areas that are predicted to have an
abundant number of species under one climate scenario, while failing to
represent the same species under an alternative climate scenario. As a
simple demonstration, we see that even multiplying the target by 3 does
not solve the problem.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p2b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://prioritizr.net/reference/problem.html" class="external-link">problem</a></span><span class="op">(</span><span class="va">costs_rast</span>, <span class="va">abundance_ssp2_rcp45</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://prioritizr.net/reference/add_min_set_objective.html" class="external-link">add_min_set_objective</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://prioritizr.net/reference/add_absolute_targets.html" class="external-link">add_absolute_targets</a></span><span class="op">(</span><span class="va">target</span> <span class="op">*</span> <span class="fl">3</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://prioritizr.net/reference/add_binary_decisions.html" class="external-link">add_binary_decisions</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://prioritizr.net/reference/add_default_solver.html" class="external-link">add_default_solver</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span></span>
<span><span class="va">s2b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">p2b</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">plot_solution_eval</span><span class="op">(</span><span class="va">s2b</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="taking-the-minimum-value-across-scenarios-climate-refugia-analyses">Taking the minimum value across scenarios (climate refugia
analyses)<a class="anchor" aria-label="anchor" href="#taking-the-minimum-value-across-scenarios-climate-refugia-analyses"></a>
</h3>
<p>A common misconception to why robust optimisation does under the hood
(one that I had in the past) was that solving a problem with a robust
approach is equivalent to solving the problem while supplying the
minimum value of the abundance across all scenarios. Such approaches are
common in so-called “climate refugia” analyses, where the objective is
to identify overlaps in species ranges across multiple climate scenarios
and direct conservation efforts to those areas.</p>
<p>For example, we can identify areas where Species 2 (the species with
broader climatic niches) are present in the dataset by taking the
minimum of the abundance estimates across climate scenarios:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">abundance_min_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">abundance_rast</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0</span>,</span>
<span>                   <span class="va">abundance_rast</span><span class="op">[[</span><span class="fl">8</span><span class="op">]</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0</span>,</span>
<span>                   <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">abundance_rast</span><span class="op">[[</span><span class="fl">5</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">abundance_min_2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>In this case, we see that there are still some overlap in species
ranges across climate scenarios. If we use the minimum to represent the
abundance for species 2, we can solve the problem, but still see that
the solution that it identifies becomes too conservative, with the
abundance levels exceeding the target by a substantial margin (leading
to higher costs).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">abundance_min</span> <span class="op">&lt;-</span> <span class="va">abundance_ssp2_rcp45</span></span>
<span><span class="va">abundance_min</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">abundance_rast</span><span class="op">[[</span><span class="fl">5</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="co"># Only set that for species 2</span></span>
<span><span class="va">p2c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://prioritizr.net/reference/problem.html" class="external-link">problem</a></span><span class="op">(</span><span class="va">costs_rast</span>, <span class="va">abundance_min</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://prioritizr.net/reference/add_min_set_objective.html" class="external-link">add_min_set_objective</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://prioritizr.net/reference/add_absolute_targets.html" class="external-link">add_absolute_targets</a></span><span class="op">(</span><span class="va">target</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://prioritizr.net/reference/add_binary_decisions.html" class="external-link">add_binary_decisions</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://prioritizr.net/reference/add_default_solver.html" class="external-link">add_default_solver</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="va">s2c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">p2c</span><span class="op">)</span></span>
<span><span class="fu">plot_solution_eval</span><span class="op">(</span><span class="va">s2c</span><span class="op">)</span></span></code></pre></div>
<p>In some cases, such an analysis may not even yield feasible
solutions. For example, consider Species 1, where its ranges do not
overlap at all across climate scenarios. Taking the minimum out of
abundance estimates of all scenarios would lead to a minimum value of
zero abundance for all planning units. If these features were used for
prioritization, the problem would be infeasible. As seen in the figure
below, the minimum value of the abundance levels are all zero in all
planning units.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">abundance_min_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">abundance_rast</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0</span>,</span>
<span>                   <span class="va">abundance_rast</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0</span>,</span>
<span>                   <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">abundance_rast</span><span class="op">[[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">abundance_min_1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">'continuous'</span>, range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="tuning-the-level-of-robustness">Tuning the level of robustness<a class="anchor" aria-label="anchor" href="#tuning-the-level-of-robustness"></a>
</h2>
<p>The confidence level parameter <code>conf_level</code> gives users
the flexibility to alter the level of robustness in the solution. This
parameter is interpreted as the minimum proportion of realizations (out
of the total number of realizations) for which the target is satisfied.
By default, the target needs to be met across all realizations
(<code>conf_level=1</code>). In some cases, relaxing the
<code>conf_level</code> parameter to something less than 1 can help the
solver find a solution that has a higher objective value, or turns it
from an infeasible problem to a feasible one.</p>
<p>The more realizations we have in the problem, the more meaningful it
is for the user to specify a <code>conf_level</code> less than 1. This
is because, say we have a problem with only 4 realizations of
uncertainty (4 scenarios). For the <code>conf_level</code> parameter to
have any effect on the solution, it has to be lower than
<code>0.75</code>, where the target can be violated in at least 1 out of
the 4 realizations. Anything higher than 0.75 will not affect the
model.</p>
<p>Now consider the case where a user has something like more than 100
realizations of data, say it is drawn from a statistical distribution.
The parameter then becomes much more meaningful. Tuning the confidence
level parameter to something like <code>0.95</code> means that the
target is met across 95% (or 95 out of 100) of the realizations,
ensuring that the constraint is held in a large proportion of
realizations and guaranteeing solution quality while giving some
flexibility for the problem to search for better solutions.</p>
<p>To demonstrate how the confidence level parameter works, we build in
additional uncertainty to our existing problem. Recall that the
abundance estimates we have are from a statistical model that is
estimated with uncertainty. Consider a matrix of coefficients
<code>beta_species_dist_*</code> that carries the uncertainty of the
parameters describing the relationship between temperature,
precipitation and expected abundance. We can then use that distribution
of parameters to draw species abundance across the scenarios we have. We
consider a small example with a total of 40 realizations of uncertainty
in this problem, with <code>n_replicates</code> replicates for each
climate scenario.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_replicates</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span></span>
<span><span class="co"># Simulate abundance levels given future climates</span></span>
<span><span class="va">ssp1_rcp26_ab_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="va">n_replicates</span>, <span class="fu">ab_draw_pois</span><span class="op">(</span><span class="va">temp_ssp1_rcp26</span>, <span class="va">prec_ssp1_rcp26</span>, <span class="va">beta_species_dist_1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ssp1_rcp26_ab_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="va">n_replicates</span>, <span class="fu">ab_draw_pois</span><span class="op">(</span><span class="va">temp_ssp1_rcp26</span>, <span class="va">prec_ssp1_rcp26</span>, <span class="va">beta_species_dist_2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ssp2_rcp45_ab_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="va">n_replicates</span>, <span class="fu">ab_draw_pois</span><span class="op">(</span><span class="va">temp_ssp2_rcp45</span>, <span class="va">prec_ssp2_rcp45</span>, <span class="va">beta_species_dist_1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ssp2_rcp45_ab_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="va">n_replicates</span>, <span class="fu">ab_draw_pois</span><span class="op">(</span><span class="va">temp_ssp2_rcp45</span>, <span class="va">prec_ssp2_rcp45</span>, <span class="va">beta_species_dist_2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ssp4_rcp60_ab_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="va">n_replicates</span>, <span class="fu">ab_draw_pois</span><span class="op">(</span><span class="va">temp_ssp4_rcp60</span>, <span class="va">prec_ssp4_rcp60</span>, <span class="va">beta_species_dist_1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ssp4_rcp60_ab_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="va">n_replicates</span>, <span class="fu">ab_draw_pois</span><span class="op">(</span><span class="va">temp_ssp4_rcp60</span>, <span class="va">prec_ssp4_rcp60</span>, <span class="va">beta_species_dist_2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ssp5_rcp85_ab_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="va">n_replicates</span>, <span class="fu">ab_draw_pois</span><span class="op">(</span><span class="va">temp_ssp5_rcp85</span>, <span class="va">prec_ssp5_rcp85</span>, <span class="va">beta_species_dist_1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ssp5_rcp85_ab_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="va">n_replicates</span>, <span class="fu">ab_draw_pois</span><span class="op">(</span><span class="va">temp_ssp5_rcp85</span>, <span class="va">prec_ssp5_rcp85</span>, <span class="va">beta_species_dist_2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>To fit this into Robust Prioritizr, we bring these replicates into 1
single multilayer raster.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">species_1_realizations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">ssp1_rcp26_ab_1</span><span class="op">)</span>, </span>
<span>                            <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">ssp2_rcp45_ab_1</span><span class="op">)</span>, </span>
<span>                            <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">ssp4_rcp60_ab_1</span><span class="op">)</span>, </span>
<span>                            <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">ssp5_rcp85_ab_1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">species_1_realizations</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"s1_ssp1_rcp26_r"</span>, <span class="fl">1</span><span class="op">:</span><span class="va">n_replicates</span><span class="op">)</span>,</span>
<span>                                   <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"s1_ssp2_rcp45_r"</span>, <span class="fl">1</span><span class="op">:</span><span class="va">n_replicates</span><span class="op">)</span>,</span>
<span>                                   <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"s1_ssp4_rcp60_r"</span>, <span class="fl">1</span><span class="op">:</span><span class="va">n_replicates</span><span class="op">)</span>,</span>
<span>                                   <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"s1_ssp5_rcp85_r"</span>, <span class="fl">1</span><span class="op">:</span><span class="va">n_replicates</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">species_2_realizations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">ssp1_rcp26_ab_2</span><span class="op">)</span>, </span>
<span>                            <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">ssp2_rcp45_ab_2</span><span class="op">)</span>, </span>
<span>                            <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">ssp4_rcp60_ab_2</span><span class="op">)</span>, </span>
<span>                            <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">ssp5_rcp85_ab_2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">species_2_realizations</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"s2_ssp1_rcp26_r"</span>, <span class="fl">1</span><span class="op">:</span><span class="va">n_replicates</span><span class="op">)</span>,</span>
<span>                                   <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"s2_ssp2_rcp45_r"</span>, <span class="fl">1</span><span class="op">:</span><span class="va">n_replicates</span><span class="op">)</span>,</span>
<span>                                   <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"s2_ssp4_rcp60_r"</span>, <span class="fl">1</span><span class="op">:</span><span class="va">n_replicates</span><span class="op">)</span>,</span>
<span>                                   <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"s2_ssp5_rcp85_r"</span>, <span class="fl">1</span><span class="op">:</span><span class="va">n_replicates</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">abundance_uncertainty</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">species_1_realizations</span>, <span class="va">species_2_realizations</span><span class="op">)</span></span>
<span><span class="va">groups_uncertainty</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"s1"</span>, <span class="va">n_replicates</span><span class="op">*</span><span class="fl">4</span><span class="op">)</span>,</span>
<span>                        <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"s2"</span>, <span class="va">n_replicates</span><span class="op">*</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Here we solve the problem without altering the confidence level. If
we do not alter the confidence level parameter, we can expect the target
to be met across all planning units.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rp2a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://prioritizr.net/reference/problem.html" class="external-link">problem</a></span><span class="op">(</span><span class="va">costs_rast</span>, <span class="va">abundance_uncertainty</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_constant_robust_constraints.html">add_constant_robust_constraints</a></span><span class="op">(</span>groups <span class="op">=</span> <span class="va">groups_uncertainty</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://prioritizr.net/reference/add_absolute_targets.html" class="external-link">add_absolute_targets</a></span><span class="op">(</span><span class="va">target</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_robust_min_set_objective.html">add_robust_min_set_objective</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://prioritizr.net/reference/add_binary_decisions.html" class="external-link">add_binary_decisions</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://prioritizr.net/reference/add_default_solver.html" class="external-link">add_default_solver</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rs2a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">rp2a</span><span class="op">)</span></span></code></pre></div>
<p>Fortunately, a solution can be found. We can see that the target is
met across all of the replicates we provide to the problem.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eval_soln_uncertain</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">soln</span>, <span class="va">return_df</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">soln</span> <span class="op">*</span> <span class="va">abundance_uncertainty</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="va">unname</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="fl">2</span>, <span class="va">sum</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>groups <span class="op">=</span> <span class="va">groups_uncertainty</span>, value <span class="op">=</span> <span class="va">dist</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">mutate</span><span class="op">(</span>target_met <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">value</span> <span class="op">&gt;=</span> <span class="va">target</span>, <span class="st">'Target met'</span>, <span class="st">'Target not met'</span><span class="op">)</span><span class="op">)</span> </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">return_df</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span>  <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, fill <span class="op">=</span> <span class="va">target_met</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_histogram</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">target</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">facet_wrap</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">groups</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'#0072B2'</span>, <span class="st">'#D55E00'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">eval_soln_uncertain</span><span class="op">(</span><span class="va">rs2a</span><span class="op">)</span></span></code></pre></div>
<p>As the number of replicates increase, it becomes increasingly hard
for the problem to find feasible solutions. It also increases the cost
of the solution.</p>
<p>If we relax the confidence level a bit, we can allow for the target
to not be met in some realizations of uncertainty. This allows the
optimisation problem to search for a lower cost solution. For example,
we can specify the <code>conf_level=0.9</code>, which mandates that the
solution meet the objective in at least 90% of the random realizations
supplied to the problem.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Note that "method = 'Chance'" may not be scalable to larger problems</span></span>
<span><span class="va">rp2b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://prioritizr.net/reference/problem.html" class="external-link">problem</a></span><span class="op">(</span><span class="va">costs_rast</span>, <span class="va">abundance_uncertainty</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_constant_robust_constraints.html">add_constant_robust_constraints</a></span><span class="op">(</span>groups <span class="op">=</span> <span class="va">groups_uncertainty</span>, conf_level <span class="op">=</span> <span class="fl">.9</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://prioritizr.net/reference/add_absolute_targets.html" class="external-link">add_absolute_targets</a></span><span class="op">(</span><span class="va">target</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_robust_min_set_objective.html">add_robust_min_set_objective</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">'Chance'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://prioritizr.net/reference/add_binary_decisions.html" class="external-link">add_binary_decisions</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://prioritizr.net/reference/add_default_solver.html" class="external-link">add_default_solver</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rs2b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">rp2b</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">eval_soln_uncertain</span><span class="op">(</span><span class="va">rs2b</span><span class="op">)</span></span></code></pre></div>
<p>We see that the proportion of the targets that were met are all at
least 90%. For Species 2, as it has a much wider representation in the
landscape, the conservation target is met in much more than 90% of the
replicates.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">eval_soln_uncertain</span><span class="op">(</span><span class="va">rs2b</span>, return_df <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">groups</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>prop_target_met <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">target_met</span> <span class="op">==</span> <span class="st">'Target met'</span><span class="op">)</span> <span class="op">)</span></span></code></pre></div>
<p>Users can also evaluate the relative trade-offs between robustness
and the costs of the solutions identified by examining the trade-off
curve across different confidence level specifications.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">conf_level_vect</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">solve_chance_cons</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">c</span><span class="op">)</span> <span class="op">{</span></span>
<span>                 <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://prioritizr.net/reference/problem.html" class="external-link">problem</a></span><span class="op">(</span><span class="va">costs_rast</span>, <span class="va">abundance_uncertainty</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                  <span class="fu"><a href="../reference/add_constant_robust_constraints.html">add_constant_robust_constraints</a></span><span class="op">(</span>groups <span class="op">=</span> <span class="va">groups_uncertainty</span>, conf_level <span class="op">=</span> <span class="va">c</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                  <span class="fu"><a href="https://prioritizr.net/reference/add_absolute_targets.html" class="external-link">add_absolute_targets</a></span><span class="op">(</span><span class="va">target</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                  <span class="fu"><a href="../reference/add_robust_min_set_objective.html">add_robust_min_set_objective</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">'Chance'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                  <span class="fu"><a href="https://prioritizr.net/reference/add_binary_decisions.html" class="external-link">add_binary_decisions</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                  <span class="fu"><a href="https://prioritizr.net/reference/add_default_solver.html" class="external-link">add_default_solver</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span>                 <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span>               <span class="op">}</span></span>
<span></span>
<span><span class="va">rp2c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">solve_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">conf_level_vect</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">start.time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">rp2c</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">solve_chance_cons</span><span class="op">(</span><span class="va">conf_level_vect</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">end.time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">solve_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">solve_times</span>, <span class="va">end.time</span> <span class="op">-</span> <span class="va">start.time</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="va">sp2c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">rp2c</span><span class="op">)</span></span>
<span><span class="va">cost_conf_level</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">sp2c</span> <span class="op">*</span> <span class="va">costs_rast</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="fl">2</span>, <span class="va">sum</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="va">chance_cons_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>conf_level <span class="op">=</span> <span class="va">conf_level_vect</span>, cost <span class="op">=</span> <span class="va">cost_conf_level</span>, <span class="va">solve_times</span><span class="op">)</span></span>
<span></span>
<span><span class="va">chance_cons_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">conf_level</span>, y <span class="op">=</span> <span class="va">cost</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_reverse</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Confidence Level'</span>, y <span class="op">=</span> <span class="st">'Cost'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Do however note that the setting of <code>conf_level</code> to
anything other than 1 will increase the solve times and can make your
problem intractable for a large number of planning units/
realizations.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">chance_cons_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">conf_level</span>, y <span class="op">=</span> <span class="va">solve_times</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_reverse</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Confidence Level'</span>, y <span class="op">=</span> <span class="st">'Solve times'</span>, title <span class="op">=</span> <span class="st">"Solve times using Chance Constraints (Gurobi)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Users should carefully evaluate whether it is necessary to adjust the
<code>conf_level</code> parameter and understand the consequences it can
have for solving larger problems.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://frankiecho.github.io/" class="external-link">Frankie Cho</a>, <a href="https://jeffrey-hanson.com" class="external-link">Jeffrey O Hanson</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
